<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',Arial,sans-serif}
        body{background:#F3FCE2;padding:20px}
        .container{max-width:600px;margin:0 auto}
        h1{text-align:center;margin-top:40px;margin-bottom:34px;color:#252525;font-size:26px;font-weight:500;letter-spacing:-0.9px}
        .products-grid{display:grid;grid-template-columns:1fr;gap:15px;margin-bottom:100px}
        .product-card{background:#FFFFFF;border-radius:10px;padding:20px 20px;display:flex;flex-direction:row;align-items:center;justify-content:flex-start;box-shadow:0 2px 8px rgba(0,0,0,0.08);cursor:pointer;transition:.2s}
        .product-card:hover{transform:translateY(-3px);box-shadow:0 3px 10px rgba(0,0,0,0.1)}
        .product-card.inactive{opacity:.3}
        .product-name{font-size:20px;font-weight:500;letter-spacing:-0.3px;color:#252525}
        .add-button{position:fixed;bottom:30px;right:30px;width:60px;height:60px;background:#fff;border-radius:50%;display:flex;justify-content:center;align-items:center;box-shadow:0 4px 15px rgba(0,0,0,.2);cursor:pointer;z-index:10}
        .add-button svg{width:24px;height:24px;color:#888}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:100;justify-content:center;align-items:center}
        .modal-content{background:#fff;width:80%;max-width:400px;border-radius:12px;padding:25px}
        .modal-title{font-size:18px;margin-bottom:20px;color:#252525}
        .input-group{margin-bottom:20px}
        .input-group label{display:block;margin-bottom:8px;font-size:14px;color:#252525}
        .input-group input{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:16px;color:#252525}
        .button-group{display:flex;justify-content:flex-end;gap:10px}
        .button{padding:10px 20px;border:none;border-radius:8px;font-size:14px;cursor:pointer}
        .button-cancel{background:#f0f0f0;color:#252525}
        .button-add{background:#333;color:#fff}
        .reset-button{position:fixed;bottom:30px;left:30px;width:60px;height:60px;background:#fff;border-radius:50%;display:flex;justify-content:center;align-items:center;box-shadow:0 4px 15px rgba(0,0,0,.2);cursor:pointer;z-index:10}
        .reset-button svg{width:24px;height:24px;color:#888}
    </style>
</head>
<body>
    <div class="container">
        <h1>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h1>

        <div class="products-grid" id="productsGrid"></div>
    </div>

    <!-- –∫–Ω–æ–ø–∫–∞ ¬´–ø–ª—é—Å¬ª -->
    <div class="add-button" id="addButton">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    </div>

    <!-- –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ¬´–¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç¬ª -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <h2 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</h2>
            <div class="input-group">
                <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                <input type="text" id="productName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞">
            </div>
            <div class="button-group">
                <button class="button button-cancel" id="cancelButton">–û—Ç–º–µ–Ω–∞</button>
                <button class="button button-add" id="confirmAddButton">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-------------------  JAVASCRIPT  ------------------->
    <script type="module">
        /* ------------------------------------------------------------------
           1. Firebase SDK
        ------------------------------------------------------------------ */
        import { initializeApp }  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAnalytics }   from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
        import {
            getFirestore, collection, doc,
            onSnapshot, addDoc, updateDoc
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        // !!!   –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ (–≤—ã –ø—Ä–∏—Å–ª–∞–ª–∏ –∏—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏)   !!!
        const firebaseConfig = {
          apiKey:            "AIzaSyBGi5CGPet9s4WAUtWx4wXu8x_R5M9JCXw",
          authDomain:        "products-f74d7.firebaseapp.com",
          projectId:         "products-f74d7",
          storageBucket:     "products-f74d7.firebasestorage.app",
          messagingSenderId: "324079574314",
          appId:             "1:324079574314:web:99d869d1d93a78bf001253",
          measurementId:     "G-5XRC792NTD"
        };

        const app       = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);      // –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç
        const db        = getFirestore(app);

        /* ------------------------------------------------------------------
           2. DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
        ------------------------------------------------------------------ */
        const productsGrid     = document.getElementById('productsGrid');
        const addButton        = document.getElementById('addButton');
        const addProductModal  = document.getElementById('addProductModal');
        const cancelButton     = document.getElementById('cancelButton');
        const confirmAddButton = document.getElementById('confirmAddButton');
        const productNameInput = document.getElementById('productName');

        /* ------------------------------------------------------------------
           3. –†–∞–±–æ—Ç–∞ —Å Firestore
        ------------------------------------------------------------------ */
        let products = [];   // –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞

        // ¬´–ñ–∏–≤–∞—è¬ª –ø–æ–¥–ø–∏—Å–∫–∞ ‚Äì –∫–∞–∫ —Ç–æ–ª—å–∫–æ —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
        onSnapshot(collection(db, "products"), (snapshot) => {
            products = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));
            renderProducts();
        });

        // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏
        async function toggleProductStatus(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            await updateDoc(doc(db, "products", productId), {
                isActive: !product.isActive
            });
            // onSnapshot —Å–∞–º –æ–±–Ω–æ–≤–∏—Ç UI –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
        }

        // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç
        async function addProduct(name) {
            await addDoc(collection(db, "products"), {
                name: name,
                isActive: true
            });
        }

        /* ------------------------------------------------------------------
           4. –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π)
        ------------------------------------------------------------------ */
        function renderProducts() {
            productsGrid.innerHTML = '';

            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
            const emojiMap = {
                '–±–∞–Ω–∞–Ω': 'üçå',
                '–º–æ–ª–æ–∫': 'ü•õ',
                '—Ö–ª–µ–±': 'üçû',
                '–±–∞—Ç–æ–Ω': 'üçû',
                '–æ–≥—É—Ä–µ—Ü': 'ü•í',
                '–æ–≥—É—Ä—Ü': 'ü•í',
                '–∫–∞—Ä—Ç–æ—à': 'ü•î',
                '–∫–∞—Ä—Ç–æ': 'ü•î',
                '–ª—É–∫': 'üßÖ',
                '—á–µ—Å–Ω–æ–∫': 'üßÑ',
                '—è–π—Ü': 'ü•ö',
                '—è–∏—Ü': 'ü•ö',
                '–∫—É—Ä–∏—Ü–∞': 'üçó',
                '–∫—É—Ä': 'üçó',
                '—à–æ–∫–æ–ª–∞–¥': 'üç´',
                '—Å–∞—Ö–∞—Ä': 'üßÅ',
                '–∫–∞–∫–∞–æ': 'üç´',
                '–º–∞–π–æ–Ω–µ–∑': 'ü´ô',
                '—Å—ã—Ä': 'üßÄ',
                '—Å–æ–ª—å': 'üßÇ',
                '–∫–µ—Ç—á—É–ø': 'ü•´',
                '–≤–æ–¥–∞': 'üíß',
                '–∫–æ—Ä–∏—Ü–∞': 'üå∫',
                '–º—É–∫–∞': 'ü´ô',
                '–ø–æ–º–∏–¥–æ—Ä': 'üçÖ',
                '—Ç–æ–º–∞—Ç': 'üçÖ',
                '–æ–≤—Å—è–Ω–∫': 'ü•£',
                '–º–∞—Å–ª–æ': 'üßà',
                '–ª–∏–º–æ–Ω': 'üçã'
            };

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞
            function getEmojiForProduct(productName) {
                const lowerName = productName.toLowerCase();
                
                for (const [key, emoji] of Object.entries(emojiMap)) {
                    if (lowerName.includes(key)) {
                        return emoji;
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —ç–º–æ–¥–∑–∏, –≤–µ—Ä–Ω–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
                return 'üõí';
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã: –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–ø–µ—Ä–µ–¥–∏, –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∞–¥–∏
            const sortedProducts = [...products].sort((a, b) => {
                // –ï—Å–ª–∏ a –∞–∫—Ç–∏–≤–µ–Ω, –∞ b –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, a –∏–¥–µ—Ç –≤–ø–µ—Ä–µ–¥–∏
                if (a.isActive && !b.isActive) return -1;
                // –ï—Å–ª–∏ a –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, –∞ b –∞–∫—Ç–∏–≤–µ–Ω, b –∏–¥–µ—Ç –≤–ø–µ—Ä–µ–¥–∏
                if (!a.isActive && b.isActive) return 1;
                // –ï—Å–ª–∏ –æ–±–∞ –∞–∫—Ç–∏–≤–Ω—ã –∏–ª–∏ –æ–±–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ—Ä—è–¥–æ–∫
                return 0;
            });

            sortedProducts.forEach(product => {
                const card = document.createElement('div');
                card.classList.add('product-card');
                if (!product.isActive) card.classList.add('inactive');
                card.dataset.id = product.id;

                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π —ç–º–æ–¥–∑–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞
                const emoji = getEmojiForProduct(product.name);
                
                card.innerHTML = `
                    <p class="product-name">${emoji}  ${product.name}</p>
                `;

                card.addEventListener('click', () => toggleProductStatus(product.id));
                productsGrid.appendChild(card);
            });
        }

        /* ------------------------------------------------------------------
           5. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª
        ------------------------------------------------------------------ */
        addButton.addEventListener('click', () => {
            addProductModal.style.display = 'flex';
            productNameInput.focus();
        });

        cancelButton.addEventListener('click', closeModal);
        addProductModal.addEventListener('click', (e) => {
            if (e.target === addProductModal) closeModal();
        });
        productNameInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') confirmAddButton.click();
        });

        confirmAddButton.addEventListener('click', async () => {
            const name = productNameInput.value.trim();
            if (!name) return;
            await addProduct(name);   // –¥–æ–±–∞–≤–∏–ª–∏ –≤ –ë–î ‚Äî onSnapshot —Å–∞–º –ø–µ—Ä–µ—Ä–∏—Å—É–µ—Ç
            closeModal();
        });

        function closeModal() {
            addProductModal.style.display = 'none';
            productNameInput.value = '';
        }

        /* ------------------------------------------------------------------
           6. –ö–Ω–æ–ø–∫–∞ ¬´—Å–±—Ä–æ—Å¬ª (–æ—Å—Ç–∞–≤–∏–ª, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ –æ—á–∏—â–∞–µ—Ç Firestore)
        ------------------------------------------------------------------ */
        const resetBtn = document.createElement('div');
        resetBtn.className = 'reset-button';
        resetBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 2v6h6"></path>
                <path d="M3 13a9 9 0 1 0 3-7.7L3 8"></path>
            </svg>`;
        document.body.appendChild(resetBtn);

        // –ø—Ä–æ—Å—Ç–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏: —É–¥–∞–ª—è–µ–º –í–°–ï –¥–æ–∫—É–º–µ–Ω—Ç—ã –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        resetBtn.addEventListener('click', async () => {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é ¬´products¬ª?')) return;
            const col = collection(db, "products");
            const snap = await onSnapshot(col, ()=>{}); // –ø–æ–ª—É—á–∏–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
            snap.forEach(async d => await updateDoc(doc(db,"products",d.id),{}));
            alert('–ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—á–∏—â–µ–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É)');
        });
    </script>
</body>
</html>
